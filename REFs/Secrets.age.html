<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Secrets.age</title>
    <link rel="icon" href="https://sempernow.github.io/refpages/sa/favicon.png">
    <link rel="stylesheet" href="https://sempernow.github.io/refpages/sa/css/normalize.css">
    <link rel="stylesheet" href="https://sempernow.github.io/refpages/sa/css/main.css">
    <!--
    <link rel="stylesheet" href="https://sempernow.github.io/refpages/sa/css/dev.css">
    -->
    <link rel="stylesheet" href="https://sempernow.github.io/refpages/sa/css/hljs.github.min.css">
    <style>

    </style>
    <script src="https://sempernow.github.io/refpages/sa/js/hl.min.js"></script>
    <script>hljs.highlightAll()</script>
</head>
<body>
    <main>
        <h1><a href="https://github.com/FiloSottile/age" title="GitHub/FiloSottile/age"><code>age</code></a> (Actually Good Encryption)</h1>

<h2>Overview</h2>

<blockquote>
<p>A simple, modern and secure encryption tool (and Go library) with small explicit keys, <strong>no config options</strong>, and UNIX-style composability.</p>
</blockquote>

<ul>
<li><code>age</code></li>
<li><code>age-keygen</code></li>
</ul>

<p>The <code>age-keygen</code> CLI creates an <strong>asymmetic</strong> identity key;
a public-private key of type <code>Ed25519</code> (X25519) <strong>exclusively</strong>.
Yet <code>age</code> also works with SSH (<code>ssh-rsa</code> and <code>ssh-ed25519</code>) keys,
and so natively integrates with Git projects.</p>

<p>Encryption and decryption of the subject message is by a
<strong>symmetric key</strong> generated per message.
That key, along with public (asymmetric) key(s) of the recipient(s),
are added to the encrypted subject message
to form the resulting
<dfn title="Asymmetric Encryption with Associated Data"><strong>AEAD</strong></dfn>
 package (encrypted and signed).
Only the recipient(s) private key(s) can decrypt it,
and only if the cleartext signature (AD) of the package verifies.</p>

<p>All these internals are transparent to the user.</p>

<p>The result includes a binary by default.
The optional PEM encoded (armor) format,
though somewhat larger,
has more use cases;
allows for embedding in JSON and such,
and transmits by HTTP more reliably.</p>

<h2>Install</h2>

<p>Available methods:</p>

<pre><code class="language-bash"># Pkg @ Ubuntu 
sudo apt -y install age

# Pkg @ Fedora
sudo dnf -y install age

# Binary method
archive=https://dl.filippo.io/age/latest?for=linux/amd64
curl -sSfL $archive -o age.tar.gz &amp;&amp;
    tar -xaf age.tar.gz &amp;&amp;
        sudo cp age/age* /usr/local/bin/ 

# Build/Install from (internet) source
# 1. Install Golang
v=1.24.1
archive=go$v.linux-amd64.tar.gz
[[ $(type -t go &gt;/dev/null 2&gt;&amp;1 &amp;&amp; go version |grep $v) ]] ||
    rm -rf /usr/local/go$v &amp;&amp;
        curl -sSfLO https://go.dev/dl/$archive &amp;&amp;
            sudo tar -C /usr/local -xzf $archive &amp;&amp;
                sudo mv /usr/local/go /usr/local/go$v &amp;&amp;
                    export PATH=&quot;$PATH:/usr/local/go$v/bin&quot;

# 2. Build/Install age and age-keygen
type -t go &amp;&amp; go install filippo.io/age/cmd/...@latest

# Build from local source
git clone github:/FiloSottile/age.git
cd age
go build ./cmd/age 
go build ./cmd/age-keygen
</code></pre>

<h2>Usage</h2>

<p>Encrypt/Decrypt a file using a new X25519 key pair</p>

<pre><code class="language-bash"># Plaintext file
secret=secrets.yaml

# Create X25519 key-pair file
key=age-keypair.txt
age-keygen -o $key

# Encrypt 
age -r $(age-keygen -y $key) -o $secret.age $secret

# Decrypt to STDOUT
age -d -i $key $secret.age
</code></pre>

<ul>
<li>Unlike <code>sops</code>, file format is preserved.</li>
</ul>

<p>Encrypt/Decrypt using a <strong>passphrase</strong>,
which is autogenerated and shown if not declared at prompt.
That passphrase alone decrypts the message.</p>

<pre><code class="language-bash"># Encrypt to PEM encoded (armor) format
age -a -p $secret &gt; $secret.pem

# Decrypt to stdout; PROMPTS for passphrase.
age -d $secret.pem
</code></pre>

<p>Encrypt for recipient(s) having SSH key pair(s)</p>

<pre><code class="language-bash"># @ Encrypt for SSH recipients
age -e -R ~/.ssh/recipient-1.pub -R ~/.ssh/recipient-2.pub -o $secret.age  $secret
</code></pre>

<ul>
<li>To encrypt for <strong>multiple recipients</strong>, use multiple &quot;<code>-R ...</code>&quot;</li>
</ul>

<p>Encrypt to <strong>PEM encoded</strong> (armor) format for a recipient having
an SSH key pair with its public key at their GitHub account.</p>

<pre><code class="language-bash">curl -s https://github.com/$account.keys \
    |age -R - -a -o $secret.age $secret
</code></pre>

<p>Recipient decrypts it (to stdout) using the private key (identity) of that pair.</p>

<pre><code class="language-bash"># @ Decrypt using recipient's private key
age -d -i ~/.ssh/identity-1 -o - $secret.age
</code></pre>

<p>Encrypt a folder archive</p>

<pre><code class="language-bash"># Create key pair
key=key.txt
age-keygen -o $key
# Get public key AKA recipient
pub=$(age-keygen -y $key)

# Encrypt (the archive of a dir)
dir=~/data
tar -cvz $dir |age -r $pub &gt; $dir.tar.gz.age

# Decrypt
age --decrypt -i $key $dir.tar.gz.age &gt; $dir.tar.gz
</code></pre>

<ul>
<li>Multiple recipients allowed; one per flag

<ul>
<li><code>-r PUB</code> : Recipient</li>
<li><code>-R PUB_FILE</code> : Recipient file</li>
</ul></li>
</ul>

<p>Create X25519 key pair using <code>age-keygen</code>.</p>

<pre><code class="language-bash">â˜© age-keygen
# created: 2025-01-07T16:23:58-05:00
# public key: age1dtyyjt0afm8ecu8plwyzxhu22mz0t7j2zzu9ddkq7qsafk7c54qq8rzqe0
AGE-SECRET-KEY-1YCVWNEFFR7QQ5PJ37UMWDNE8JFZGYUXP5K9G29J3R0387ZLCUN2QZARH80
</code></pre>

<ul>
<li><code>-o</code>, <code>--output</code> <code>FILE</code> : Write the resulting identity (X25529 key pair) to <code>FILE</code> (path)</li>
<li><code>-y FILE</code> : Convert the identity file (X25519 key pair) to recipient.

<ul>
<li>This extracts the public-key <em>string</em> from the X25519 key-pair <em>file</em> located at <code>FILE</code>.</li>
</ul></li>
</ul>

<h3>&nbsp;</h3>
 
    </main>

    <script src="https://sempernow.github.io/refpages/sa/js/base.js"></script>
    <script>
        ;(function(o, undefined){
            'use strict'
            window.addEventListener('load', () => {
                ;(() => {})//()
                ;(() => {})//()
                ;(() => { // FOO LAB
                    const log = o.log('foo')
                        ,main = o.css('MAIN')
                    log('foo')
                    o.toDOM(main, '<h1>TEST</h1>')
                })//()
            })
        })( (typeof window !== 'undefined') 
            && (window[__APP__] = window[__APP__] || {})
                || (typeof global !== 'undefined') 
                    && (global[__APP__] = global[__APP__] || {})
        );
    </script>
</body>
</html>
