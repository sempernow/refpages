<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>K8s.Volumes</title>
    <link rel="icon" href="https://sempernow.github.io/refpages/sa/favicon.png">
    <link rel="stylesheet" href="https://sempernow.github.io/refpages/sa/css/normalize.css">
    <link rel="stylesheet" href="https://sempernow.github.io/refpages/sa/css/main.css">
    <!--
    <link rel="stylesheet" href="https://sempernow.github.io/refpages/sa/css/dev.css">
    -->
    <link rel="stylesheet" href="https://sempernow.github.io/refpages/sa/css/hljs.github.min.css">
    <style>

    </style>
    <script src="https://sempernow.github.io/refpages/sa/js/hl.min.js"></script>
    <script>hljs.highlightAll()</script>
</head>
<body>
    <main>
        <h1><a href="https://kubernetes.io/docs/concepts/storage/volumes/" title="Kubernetes.io">Kubernetes : Volumes</a></h1>

<h2><a href="https://kubernetes.io/docs/concepts/storage/volumes/#local"><code>local</code></a></h2>

<p>Compared to <code>hostPath</code> volumes, <code>local</code> volumes are used in a <strong><em>durable and portable</em></strong> manner <strong><em>without manually scheduling pods to nodes</em></strong>. The system is aware of the volume's node constraints by looking at the node affinity on the PersistentVolume. Both <code>local</code> and <code>hostPath</code> are analogous to Docker bind mount.</p>

<blockquote>
<p>Where possible, use <code>local</code> instead of <code>hostPath</code></p>
</blockquote>

<ul>
<li>Must set a PersistentVolume nodeAffinity when using local volumes. The Kubernetes scheduler uses the PersistentVolume nodeAffinity to schedule these Pods to the correct node.</li>
<li>PersistentVolume <code>volumeMode</code> can be set to &quot;<code>Block</code>&quot; (instead of the default value &quot;Filesystem&quot;) to expose the local volume as a raw block device.</li>
<li>It is recommended to <strong>create a <code>StorageClass</code></strong> having &quot;<code>volumeBindingMode: WaitForFirstConsumer</code>&quot;.</li>
<li>Use an external provisioner:

<ul>
<li><a href="https://rook.io/">Rook</a> : Production ready management for File, Block and Object Storage.
Rook orchestrates the Ceph storage solution, with a specialized Kubernetes Operator to automate management.

<ul>
<li><a href="https://rook.io/docs/rook/latest-release/Getting-Started/quickstart/#tldr">Rook Operator : Quick Start</a></li>
<li><a href="https://rook.io/docs/rook/latest-release/Helm-Charts/operator-chart/">Ceph Operator Helm Chart</a></li>
</ul></li>
<li><a href="https://longhorn.io/">Longhorn</a> : Cloud native distributed block storage for Kubernetes</li>
<li><a href="https://github.com/kubernetes-sigs/sig-storage-local-static-provisioner">Local Persistence Volume Static Provisioner</a></li>
</ul></li>
</ul>

<p><code>local</code> @ <code>PersistentVolume</code> manifest</p>

<pre><code class="language-yaml">apiVersion: v1
kind: PersistentVolume
metadata:
  name: example-pv
spec:
  capacity:
    storage: 100Gi
  volumeMode: Filesystem
  accessModes:
  - ReadWriteOnce
  persistentVolumeReclaimPolicy: Delete
  # Any name here okay
  storageClassName: local-storage
    # Advised for local
    volumeBindingMode: WaitForFirstConsumer
  local:
    path: /mnt/disks/ssd1
  # MUST use nodeAffinity
  nodeAffinity:
    required:
      nodeSelectorTerms:
      - matchExpressions:
        - key: kubernetes.io/hostname
          operator: In
          values:
          - example-node
</code></pre>

<h2><a href="https://kubernetes.io/docs/concepts/storage/volumes/#hostpath"><code>hostPath</code></a></h2>

<p>HostPath is the Kubenetes equivalent to Docker's bind mount.
Must restrict pod to same node (host) as the volume.</p>

<p><code>hostPath</code> @ <code>Pod</code> manifest</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: my-pod
spec:
  nodeName: specific-node-name
  containers:
    - name: my-container
      image: your-container-image
      volumeMounts:
        - name: host-path-volume
          mountPath: /path/in/container  # Mount path inside the container
  volumes:
    - name: host-path-volume
      hostPath:
        path: /path/on/host  # Path on the specific node you want to bind

</code></pre>

<h3>&nbsp;</h3>

<!-- 

# Markdown Cheatsheet

[Markdown Cheatsheet](https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet "Wiki @ GitHub")


# Link @ (HTML | MD)

([HTML](___.md "___"))   


# Bookmark

- Reference
[Foo](#foo)

- Target
<a name="foo"></a>

-->
 
    </main>

    <script src="https://sempernow.github.io/refpages/sa/js/base.js"></script>
    <script>
        ;(function(o, undefined){
            'use strict'
            window.addEventListener('load', () => {
                ;(() => {})//()
                ;(() => {})//()
                ;(() => { // FOO LAB
                    const log = o.log('foo')
                        ,main = o.css('MAIN')
                    log('foo')
                    o.toDOM(main, '<h1>TEST</h1>')
                })//()
            })
        })( (typeof window !== 'undefined') 
            && (window[__APP__] = window[__APP__] || {})
                || (typeof global !== 'undefined') 
                    && (global[__APP__] = global[__APP__] || {})
        );
    </script>
</body>
</html>
