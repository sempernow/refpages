# [CSRF](https://owasp.org/www-community/attacks/csrf "OWASP.org") | [`CORS`](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS "Cross-origin Resource Sharing @ MDN") 

>[_CORS Is Not a CSRF Prevention Mechanism._](https://www.nccgroup.com/us/about-us/newsroom-and-events/blog/2017/september/common-csrf-prevention-misconceptions/ "nccgroup.com") &hellip; _Any request generated by an HTML form will necessarily be a_ [_simple request_](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#Preflighted_requests "MDN") _and will never be preflighted. Form submissions can be sent from any origin to any other origin. &hellip; While a properly configured CORS policy is important, it does not in itself constitute a CSRF defense._

## Scenario

1. The target, Joe, is logged into their account at `https://bank.com`.
1. The target then visits the web site of the perp, Tom, at `https://foo.com`. 
1. Tom places the _malicious URL at his own site_ exploiting the fact that Tom is logged in at the  `bank.com` site.

The perp knows the proper `bank.com` URL for requesting a transfer of money from Joe's account into Tom's account &hellip;

```html
<a href="https://bank.com/transfer.do?acct=TOM&amount=100000">View my Pictures!</a>
```

Or as a 0x0 fake image:

```html
<img src="https://bank.com/transfer.do?acct=TOM&amount=100000" width="0" height="0" border="0">
```

The server does not know ___this is a cross-origin request___ because it _fails to match request header_ `Referer` against that of `Host`, and so allows the exploit.

## [Mitigate](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html "owasp.org") 

- ___Validate request headers___; either "`Referer`" or "`Origin`", matching the value against that of "`Host`" request header.
    - Strong test, i.e., test against host string of `//foo.com/`, not merely `/foo.com` or worse still `foo.com`, which may be of origin `foo.com.bad.com`.
    ```golang
        if !strings.Contains(r.Referer(), "//"+r.Host) && r.Referer() != "" {
            err = errors.New("no hotlinks")
        }
    ```
- Enforce Same-site policy
    - No CORS, or tightly controlled, server-side
    - Cookie set per "`SameSite: strict`"
- Prevent [XSS](https://owasp.org/www-community/attacks/xss/ "OWASP.org") using [CSP](https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP "Content Security Policy @ MDN") HTTP header along with [Subresource Integrity (nonces)](https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity "MDN")
- Use [Custom Request Headers](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#use-of-custom-request-headers)
    - By default, browsers do not allow scripts (JS) to make cross-origin requests with custom headers.
- [CSRF (Synchronizer) Token](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#synchronizer-token-pattern)
- _Stateless CSRF mitigation_ a.k.a. [_Double Submit Cookie_](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#double-submit-cookie) method.
    - Server sends nonce with HTML form per hidden form key attribute and/or HTTP header, which client returns with the subsequent POST request per ___both___ request parameter (e.g., form key value) and HTTP header (`X-CSRF-Token: 1qlkhh12u15...`); validate per match ___and___ same-site tests.

### &nbsp;
<!-- 

# Markdown Cheatsheet

[Markdown Cheatsheet](https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet "Wiki @ GitHub")


# Link @ (MD | HTML)

([MD](___.html "@ browser"))   


# Bookmark

- Reference
[Foo](#foo)
- Target
<a name="foo"></a>

-->

