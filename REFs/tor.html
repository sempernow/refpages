<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>tor</title>
    <link rel="icon" href="https://sempernow.github.io/refpages/sa/favicon.png">
    <link rel="stylesheet" href="https://sempernow.github.io/refpages/sa/css/normalize.css">
    <link rel="stylesheet" href="https://sempernow.github.io/refpages/sa/css/main.css">
    <!--
    <link rel="stylesheet" href="https://sempernow.github.io/refpages/sa/css/dev.css">
    -->
    <link rel="stylesheet" href="https://sempernow.github.io/refpages/sa/css/hljs.github.min.css">
    <style>

    </style>
    <script src="https://sempernow.github.io/refpages/sa/js/hl.min.js"></script>
    <script>hljs.highlightAll()</script>
</head>
<body>
    <main>
        <h1><a href="https://en.wikipedia.org/wiki/Tor_(network)" title="Wikipedia">Tor Network</a> | <a href="https://linux.die.net/man/1/tor" title="man page @ linux.die.net"><code>tor(1)</code></a> | <a href="https://2019.www.torproject.org/docs/documentation.html.en" title="2019 yet no other">Documentation (Obsolete)</a> | <a href="https://www.torproject.org/" title="TorProject.org : has NO Documentation!">Tor Project</a></h1>

<blockquote>
<p><code>tor</code> is a connection-oriented anonymizing communication service. Users choose a source-routed path through a set of nodes, and negotiate a &quot;virtual circuit&quot; through the network, in which each node knows its predecessor and successor, but no others. Traffic flowing down the circuit is unwrapped by a symmetric key at each node, which reveals the downstream node.</p>
</blockquote>

<p>Basically tor provides a distributed network of servers (&quot;onion routers&quot;). Users bounce their TCP streams - web traffic, ftp, ssh, etc - around the routers, and recipients, observers, and even the routers themselves have difficulty tracking the source of the stream.</p>

<p>(Excerpts from <a href="https://linux.die.net/man/1/tor" title="man page @ linux.die.net"><code>tor(1)</code> man page.</a>)</p>

<h2>Install</h2>

<p>Tor Browser @ Windows</p>

<pre><code class="language-text">choco install tor-browser
</code></pre>

<p><code>tor</code> CLI @ Linux</p>

<pre><code class="language-bash">sudo apt install tor 
</code></pre>

<pre><code class="language-bash">sudo systemctl restart tor 

# Start tor process per commandline
tor -f $config_file_path

# Validate config
tor --verify-config

# List options
tor --list-torrc-options
</code></pre>

<h2>Config : <code>torrc</code></h2>

<p>@ <code>/etc/tor/torrc</code></p>

<pre><code class="language-text">HiddenServiceDir /var/lib/tor/hidden_service/
HiddenServicePort 80 127.0.0.1:80
</code></pre>

<ul>
<li><code>HiddenServicePort VIRTUALPORT TARGET</code></li>
<li>@ Docker <code>service</code>

<ul>
<li><code>HiddenServicePort VIRTUALPORT SVC_NAME:PORT</code></li>
</ul></li>
</ul>

<h2>Tor SOCKS5 Proxy</h2>

<p>Anonymizer for use with HTTP(S) client, such as browser or cURL.</p>

<p>@ <code>torrc</code></p>

<pre><code class="language-bash">SOCKSPort 0.0.0.0:9050
</code></pre>

<p>Test client anonymization</p>

<pre><code class="language-bash">☩ curl ifconfig.me
71.123.123.123  #... from ISP

☩ curl --socks5-hostname 127.0.0.1:9150  ifconfig.me
198.98.60.90    #... from Tor Network (randomized per session)
</code></pre>

<p>Test Tor network connectivity</p>

<pre><code class="language-bash"># Request : GET tor site
export onion='tenf4wqudyjibh4igv6ir5vjmumo4omi55tu2lncaxpkx7r2a7darjqd.onion'
curl -v --socks5-hostname 127.0.0.1:9050 http://${onion}/
curl -v -x socks5h://127.0.0.1:9050 http://${onion}/
</code></pre>

<pre><code class="language-text">*   Trying 127.0.0.1...
* TCP_NODELAY set
* SOCKS5 communication to tenf4wqudyjibh4igv6ir5vjmumo4omi55tu2lncaxpkx7r2a7darjqd.onion:80
* Can't complete SOCKS5 connection to 0.0.0.0:0. (4)
* Closing connection 0
curl: (7) Can't complete SOCKS5 connection to 0.0.0.0:0. (4)
</code></pre>

<ul>
<li>Exit code <code>4</code> : Undocumented; this exit code is skipped in man page!

<ul>
<li><em>A feature or option that was needed to perform the desired request was not enabled or was explicitly disabled at build-time. To make curl able to do this, you probably need another build of libcurl.</em>
<a href="https://everything.curl.dev/usingcurl/returns">https://everything.curl.dev/usingcurl/returns</a></li>
</ul></li>
</ul>

<h2>Tor Hidden Service(s)</h2>

<h3>Hostname (*.onion; Onion address)</h3>

<h4>@ <code>/var/lib/tor/hidden_service/</code></h4>

<p>The <code>hostname</code> is ephemeral (regenerated per restart) lest it and its public-private key pair exist</p>

<pre><code class="language-bash">cat /var/lib/tor/hidden_service/hostname
</code></pre>

<pre><code class="language-bash">/ $ ls -ahl /var/lib/tor/hidden_service/
total 24K
drwx------    3 tor      nogroup     4.0K Dec  5 21:13 .
drwx------    4 tor      root        4.0K Dec  6 14:20 ..
drwx------    2 tor      nogroup     4.0K Dec  5 21:05 authorized_clients
-rw-------    1 tor      nogroup       63 Dec  5 21:13 hostname
-rw-------    1 tor      nogroup       64 Dec  5 21:13 hs_ed25519_public_key
-rw-------    1 tor      nogroup       96 Dec  5 21:13 hs_ed25519_secret_key
</code></pre>

<ul>
<li>Directory MUST have mode <code>0700</code>, else error: &quot;... excessive permissions ...&quot;.</li>
</ul>

<p>Persist hostname and keys for static address</p>

<pre><code class="language-bash">export onion_addr=&quot;$(cat /var/lib/tor/hidden_service/hostname)&quot;
</code></pre>

<h2>Nginx config</h2>

<pre><code class="language-ini">server {
    listen 8888 default_server;
    listen [::]:8888 default_server;
    #server_name tenf4wqudyjibh4igv6ir5vjmumo4omi55tu2lncaxpkx7r2a7darjqd.onion;
    server_name _;
    location / {
        root    /var/www/html;
        index   index.html;
    }
}
</code></pre>

<ul>
<li>&quot;<code>default_server</code>&quot; combined with &quot;<code>server_name _;</code>&quot;
affect a catch-all server block.</li>
</ul>
 
    </main>

    <script src="https://sempernow.github.io/refpages/sa/js/base.js"></script>
    <script>
        ;(function(o, undefined){
            'use strict'
            window.addEventListener('load', () => {
                ;(() => {})//()
                ;(() => {})//()
                ;(() => { // FOO LAB
                    const log = o.log('foo')
                        ,main = o.css('MAIN')
                    log('foo')
                    o.toDOM(main, '<h1>TEST</h1>')
                })//()
            })
        })( (typeof window !== 'undefined') 
            && (window[__APP__] = window[__APP__] || {})
                || (typeof global !== 'undefined') 
                    && (global[__APP__] = global[__APP__] || {})
        );
    </script>
</body>
</html>
